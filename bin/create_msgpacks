#! /usr/bin/env python

import sys
import os
import inspect
_path = inspect.currentframe()
_path = inspect.getfile(_path)
_path = os.path.abspath(_path)
_path = os.path.dirname(os.path.dirname(_path))
_path = os.path.join(_path, 'python')
sys.path.append(_path)

_script = inspect.currentframe()
_script = inspect.getfile(_script)
_script = os.path.abspath(_script)
_script = os.path.dirname(_script)
_script = os.path.join(_script, 'to_format')

from core.utils import execute_python_subshells
# ------------------------------------------------------------------------------

def get_target(fullpath, format_):
    base, filename = os.path.split(fullpath)
    base = os.path.dirname(base)
    filename = os.path.splitext(filename)[0] + '.' + format_
    return os.path.join(base, format_, filename)

def create_msgpacks(root):
    args = [os.path.join(root, x) for x in os.listdir(root)]
    args = [(x, get_target(x, 'msgpack')) for x in args]
    target = os.path.split(args[0][1])[0]
    if not os.path.exists(target):
        os.mkdir(target)
    execute_python_subshells(_script, args)

if __name__ == '__main__':
    create_msgpacks(sys.argv[1])